@model ITAssetKeeper.Models.ViewModels.Device.DeviceDto

@{
    ViewData["Title"] = "Details";
}

<h2>機器情報</h2>

<!-- メッセージ表示 -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success mt-3">
        @TempData["SuccessMessage"]
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-warning mt-3">
        @TempData["ErrorMessage"]
    </div>
}

@if (TempData["FailureMessage"] != null)
{
    <div class="alert alert-danger mt-3">
        @TempData["FailureMessage"]
    </div>
}

<div class="row">
    <div class="col-md-6">

        @* 機器管理ID(ManagementId) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.ManagementId)</label>
            <div>@Model.ManagementId</div>
        </div>

        @* 種別(Category) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.Category)</label>
            <div>@Model.Category</div>
        </div>

        @* 用途(Purpose) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.Purpose)</label>
            <div>@Model.Purpose</div>
        </div>

        @* 型番(ModelNumber) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.ModelNumber)</label>
            <div>@Model.ModelNumber</div>
        </div>

        @* 製造番号(SerialNumber) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.SerialNumber)</label>
            <div>@Model.SerialNumber</div>
        </div>

        @* ホスト名(HostName) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.HostName)</label>
            <div>@Model.HostName</div>
        </div>

        @* 設置場所(Location) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.Location)</label>
            <div>@Model.Location</div>
        </div>

        @* 使用者(UserName) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.UserName)</label>
            <div>@Model.UserName</div>
        </div>

        @* 状態(Status) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.Status)</label>
            <div>@Model.Status</div>
        </div>

        @* 購入日(PurchaseDate) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.PurchaseDate)</label>
            <div>@Model.PurchaseDate</div>
        </div>

        @* 登録日(CreatedAt) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.CreatedAt)</label>
            <div>@Model.CreatedAt</div>
        </div>

        @* 更新日(UpdatedAt) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.UpdatedAt)</label>
            <div>@Model.UpdatedAt</div>
        </div>

        @* メモ欄(Memo) *@
        <div class="form-group mb-2">
            <label class="fw-bold">@Html.DisplayNameFor(m => m.Memo)</label>
            <div>@Model.Memo</div>
        </div>

        <div class="mt-4">

            <!-- 戻る -->
            <a asp-action="Index" class="btn btn-secondary me-2">一覧へ戻る</a>

            @* ロール判定で編集や削除を制限 *@
            @if (User.IsInRole("Admin") || User.IsInRole("Editor"))
            {
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary me-2">編集</a>
            }

            @if (User.IsInRole("Admin"))
            {
                @* <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger">削除</a> *@
                @* 削除ボタンはページ遷移せずモーダル起動 *@
                <button type="button"
                        class="btn btn-danger"
                        id="btnOpenDeleteModal"
                        data-device-id="@Model.Id"
                        data-device-mgmtid="@Model.ManagementId"
                        data-device-category="@Model.Category"
                        data-device-status="@Model.Status">
                    削除
                </button>
            }
        </div>
    </div>
</div>


@* 削除確認モーダル *@
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header text-white" style="background:#6c3af0;">
                <h5 class="modal-title">🗑 削除確認</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <p>対象の機器情報を削除します。よろしいですか？</p>
                <ul class="small">
                    <li>機器管理ID：<span id="delMgmtId"></span></li>
                    <li>種別：<span id="delCategory"></span></li>
                    <li>状態：<span id="delStatus"></span></li>
                </ul>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                <button type="button" id="btnDeleteExec" class="btn btn-danger">削除</button>
            </div>

        </div>
    </div>
</div>


<!-- Toast -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="resultToast" class="toast align-items-center text-white border-0"
         role="alert" aria-live="assertive" aria-atomic="true"
         data-bs-delay="5000">
        <div class="d-flex">
            <div class="toast-body" id="toastMessage"></div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

@* 外部JS読み込み *@
@section Scripts {
    <script src="~/js/device-delete.js"></script>
}

