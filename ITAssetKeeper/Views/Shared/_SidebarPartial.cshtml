@using Microsoft.AspNetCore.Identity
@using ITAssetKeeper.Models.Entities
@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager

@{
    var user = await UserManager.GetUserAsync(User);
    var roles = user != null ? await UserManager.GetRolesAsync(user) : new List<string>();
    bool isAdmin = roles.Contains("Admin");
    bool isEditor = roles.Contains("Editor");
    bool isViewer = roles.Contains("Viewer");
}

<div class="sidebar">
    @* ロゴ表示 *@
    <div class="sidebar-logo-box">
        <div class="sidebar-logo-container">
            <img src="~/img/logo.png" class="logo-image" alt="logo" />
            <span class="sidebar-logo-title-text">IT Asset Keeper</span>
        </div>
    </div>

    <ul class="sidebar-menu">

        @*  DashBoard（Adminのみ）*@
        @if (isAdmin)
        {
            <li>
                <a asp-controller="Dashboard" asp-action="Admin"
                   class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Dashboard" ? "active" : "")">
                    <i class="bi bi-speedometer2"></i> ダッシュボード
                </a>
            </li>
        }

        @* 機器一覧(全ロール) *@
        <li>
            <a asp-controller="Device" asp-action="Index"
               class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Device"
                        && ViewContext.RouteData.Values["action"]?.ToString() == "Index"
                        ? "active" : "")">
                <i class="bi bi-laptop"></i> 機器情報
            </a>
        </li>

        @* 機器登録(Adminのみ) *@
        @if (isAdmin)
        {
            <li>
                <a asp-controller="Device" asp-action="Create"
                    class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "Device"
                        && ViewContext.RouteData.Values["action"]?.ToString() == "Create"
                        ? "active" : "")">
                <i class="bi bi-speedometer2"></i> 機器情報 登録
                </a>
            </li>
        }

        @* 履歴(全ロール) *@
        <li>
            <a asp-controller="DeviceHistory" asp-action="Index"
               class="@(ViewContext.RouteData.Values["controller"]?.ToString() == "DeviceHistory" ? "active" : "")">
                <i class="bi bi-clock-history"></i> 更新履歴
            </a>
        </li>

        @* ユーザー一覧 (Admin / Editor) *@
        @if (isAdmin || isEditor)
        {
            <li>
                <a asp-controller="User" asp-action="Index">
                    <i class="bi bi-people"></i> ユーザー 管理
                </a>
            </li>
        }

        @* ユーザー管理 (Adminのみ) *@
        @* @if (isAdmin)
        {
            <li>
                <a asp-controller="Role" asp-action="Index">
                    <i class="bi bi-shield-lock"></i> ユーザー管理
                </a>
            </li>
        } *@

    </ul>

    
    <ul class="sidebar-footer">
        @* アカウント *@
        <li>
            <a asp-controller="Account" asp-action="Profile" asp-route-username="@user.UserName"
               class="sidebar-footer-link" id="profileLink">
                アカウント
            </a>
        </li>

        @* ログアウト *@
        <li>
            <a href="#" class="sidebar-footer-link" id="logoutLink">ログアウト</a>
        </li>
    </ul>

    @* サイドバーフッター *@
    <div class="sidebar-footer-logo">
        © 2025 - IT Asset Keeper
    </div>
</div>

